<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function returns a data.frame where each row provides one or
several goodness-of-fit measures between a simulated and an observed
Origin-Destination matrix."><title>Compute goodness-of-fit measures between observed and simulated OD matrices — gof • TDLM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute goodness-of-fit measures between observed and simulated OD matrices — gof"><meta property="og:description" content="This function returns a data.frame where each row provides one or
several goodness-of-fit measures between a simulated and an observed
Origin-Destination matrix."><meta property="og:image" content="https://epivec.github.io/TDLM/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">TDLM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/TDLM.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EpiVec/TDLM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute goodness-of-fit measures between observed and simulated OD matrices</h1>
      <small class="dont-index">Source: <a href="https://github.com/EpiVec/TDLM/blob/HEAD/R/gof.R" class="external-link"><code>R/gof.R</code></a></small>
      <div class="d-none name"><code>gof.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function returns a data.frame where each row provides one or
several goodness-of-fit measures between a simulated and an observed
Origin-Destination matrix.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gof</span><span class="op">(</span></span>
<span>  <span class="va">sim</span>,</span>
<span>  <span class="va">obs</span>,</span>
<span>  measures <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  <span class="va">distance</span>,</span>
<span>  bin_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  use_proba <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  check_names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>sim</dt>
<dd><p>an object of class <code>TDLM</code> (output of <code><a href="run_law_model.html">run_law_model()</a></code>,
<code><a href="run_law.html">run_law()</a></code> or <code><a href="run_model.html">run_model()</a></code>).
A matrix or a list of matrix can also be used (see Note).</p></dd>


<dt>obs</dt>
<dd><p>a squared matrix representing the observed mobility flows.</p></dd>


<dt>measures</dt>
<dd><p>a vector of string(s) indicating which goodness-of-fit
measure(s) to chose (see Details). If <code>"all"</code> is specified, then all measures
will be calculated.</p></dd>


<dt>distance</dt>
<dd><p>a squared matrix representing the distance between locations.
Only necessary for the distance-based measures.</p></dd>


<dt>bin_size</dt>
<dd><p>a numeric value indicating the size of bin used to discretize
the distance distribution to compute CPC_d (2 "km" by default).</p></dd>


<dt>use_proba</dt>
<dd><p>a boolean indicating if the <code>proba</code> matrix should be used
instead of the simulated OD matrix to compute the measure(s). Only valid for
the output from <code><a href="run_law_model.html">run_law_model()</a></code> with argument <code>write_proba = TRUE</code> (see
Note).</p></dd>


<dt>check_names</dt>
<dd><p>a boolean indicating if the ID location are used as matrix
rownames and colnames and if they should be checked (see Note).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data.frame providing one or several goodness-of-fit measure(s) between
simulated OD(s) and an observed OD. Each row corresponds to a matrix sorted
according to the list (or list of list) elements (names are used if
provided).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>

With <em></em>\(n\) the number of locations, <em></em>\(T_{ij}\) the observed
flow between location <em></em>\(i\) and location <em></em>\(j\)
(argument <code>obs</code>), <em></em>\(\tilde{T}_{ij}\) a simulated flow
between location <em></em>\(i\) and location <em></em>\(j\) (a matrix from
argument <code>sim</code>), <em></em>\(N=\sum_{i,j=1}^n T_{ij}\) the
sum of observed flows and
<em></em>\(\tilde{N}=\sum_{i,j=1}^n \tilde{T}_{ij}\)
the sum of simulated flows.</p>
<p>Several goodness-of-fit measures have been considered
<code>measures = c("CPC", "NRMSE", "KL", "CPL", "CPC_d", "KS")</code>. The Common Part
of Commuters (Gargiulo et al. 2012; Lenormand et al. 2012; Lenormand et al. 2016)
,</p>
<p><em></em>\(\displaystyle CPC(T,\tilde{T}) = \frac{2\cdot\sum_{i,j=1}^n min(T_{ij},\tilde{T}_{ij})}{N + \tilde{N}}\)</p>
<p>the Normalized Root Mean Square Error (NRMSE),</p>
<p><em></em>\(\displaystyle NRMSE(T,\tilde{T}) = \sqrt{\frac{\sum_{i,j=1}^n (T_{ij}-\tilde{T}_{ij})^2}{N}}\)</p>
<p>the Kullback–Leibler divergence (Kullback and Leibler 1951)
,</p>
<p><em></em>\(\displaystyle KL(T,\tilde{T}) = \sum_{i,j=1}^n \frac{T_{ij}}{N}\log\left(\frac{T_{ij}}{N}\frac{\tilde{N}}{\tilde{T}_{ij}}\right)\)</p>
<p>the Common Part of Links (CPL) (Lenormand et al. 2016)
,</p>
<p><em></em>\(\displaystyle CPL(T,\tilde{T}) = \frac{2\cdot\sum_{i,j=1}^n 1_{T_{ij}&gt;0} \cdot 1_{\tilde{T}_{ij}&gt;0}}{\sum_{i,j=1}^n 1_{T_{ij}&gt;0} + \sum_{i,j=1}^n 1_{\tilde{T}_{ij}&gt;0}}\)</p>
<p>the Common Part of Commuters based on the disance
(Lenormand et al. 2016)
, noted CPC_d. Let us consider
<em></em>\(N_k\) (and <em></em>\(\tilde{N}_k\)) the
sum of observed (and simulated) flows at a distance comprised in the bin
[<code>bin_size</code>*k-<code>bin_size</code>, <code>bin_size</code>*k[.</p>
<p><em></em>\(\displaystyle CPC_d(T,\tilde{T}) = \frac{2\cdot\sum_{k=1}^{\infty} min(N_{k},\tilde{N}_{k})}{N+\tilde{N}}\)</p>
<p>and the Kolmogorv-Smirnov statistic and p-value (Massey 1951)

, noted KS. It is based on the observed and simulated flow distance
distribution and computed with the <a href="https://rdrr.io/pkg/Ecume/man/ks_test.html" class="external-link">ks_test</a> function from
the <a href="https://cran.rstudio.com/web/packages/Ecume/index.html" class="external-link">Ecume</a> package.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>By default, if <code>sim</code> is an output of <code><a href="run_law_model.html">run_law_model()</a></code>
the measure(s) are computed only for the simulated OD matrices and
not the <code>proba</code> matrix (included in the output when
<code>write_proba = TRUE</code>). The argument <code>use_proba</code> can be used to compute the
measure(s) based on the <code>proba</code> matrix instead of the simulated
OD matrix. In this case the argument <code>obs</code> should also be a proba matrix.</p>
<p>All the inputs should be based on the same number of
locations sorted in the same order. It is recommended to use the location ID
as matrix rownames and matrix colnames and to set
<code>check_names = TRUE</code> to verify that everything is in order before running
this function (<code>check_names = FALSE</code> by default). Note that the function
<code><a href="check_format_names.html">check_format_names()</a></code> can be used to control the validity of all the inputs
before running the main package's functions.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Lenormand M, Bassolas A, Ramasco JJ (2016).
“Systematic comparison of trip distribution laws and models.”
<em>Journal of Transport Geography</em>, <b>51</b>, 158-169.</p>
<p>Gargiulo F, Lenormand M, Huet S, Baqueiro Espinosa O (2012).
“Commuting network model: getting to the essentials.”
<em>Journal of Artificial Societies and Social Simulation</em>, <b>15</b>(2), 13.</p>
<p>Lenormand M, Huet S, Gargiulo F, Deffuant G (2012).
“A Universal Model of Commuting Networks.”
<em>PLoS ONE</em>, <b>7</b>, e45985.</p>
<p>Kullback S, Leibler RA (1951).
“On Information and Sufficiency.”
<em>The Annals of Mathematical Statistics</em>, <b>22</b>(1), 79 -- 86.</p>
<p>Massey FJ (1951).
“The Kolmogorov-Smirnov test for goodness of fit.”
<em>Journal of the American Statistical Association</em>, <b>46</b>(253), 68--78.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="run_law_model.html">run_law_model()</a></code> <code><a href="run_law.html">run_law()</a></code> <code><a href="run_model.html">run_model()</a></code> <code><a href="run_law_model.html">run_law_model()</a></code>
<code><a href="check_format_names.html">check_format_names()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Maxime Lenormand (<a href="mailto:maxime.lenormand@inrae.fr">maxime.lenormand@inrae.fr</a>)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ind</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Maxime Lenormand.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

