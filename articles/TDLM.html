<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="TDLM">
<title>Tutorial for TDLM • TDLM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial for TDLM">
<meta property="og:description" content="TDLM">
<meta property="og:image" content="https://epivec.github.io/TDLM/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">TDLM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/TDLM.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EpiVec/TDLM/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tutorial for TDLM</h1>
                        <h4 data-toc-skip class="author">Maxime
Lenormand</h4>
            
            <h4 data-toc-skip class="date">2023-03-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EpiVec/TDLM/blob/HEAD/vignettes/TDLM.Rmd" class="external-link"><code>vignettes/TDLM.Rmd</code></a></small>
      <div class="d-none name"><code>TDLM.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial aims at describing the different features of the R
package <code>TDLM</code>. The main purpose of the <code>TDLM</code>’s
package is to propose a rigorous framework to fairly compare trip
distribution laws and models <span class="citation">(Lenormand,
Bassolas, and Ramasco 2016)</span>. This general framework is based on a
two-step approach to generate mobility flows by separating the trip
distribution law, gravity or intervening opportunities, from the
modeling approach used to generate the flows from this law.</p>
</div>
<div class="section level2">
<h2 id="a-short-note-on-terminology">A short note on terminology<a class="anchor" aria-label="anchor" href="#a-short-note-on-terminology"></a>
</h2>
<p>This framework is part of the four-step travel model. It corresponds
to the second step, called trip distribution, the aim of which is to
match the trip origins with the trip destinations. The model used to
generate the trips or flows, and more generally the degree of
interaction between different locations, are often called spatial
interaction models. According to the research area, a matrix or a
network formalism can be used to describe these spatial interactions.
Origin-Destination matrix (or trip table) are often used in geography or
transportation while in statistical physics or in the study of complex
systems the term mobility networks is usually preferred.</p>
</div>
<div class="section level2">
<h2 id="origindestination-matrix">Origin–Destination matrix<a class="anchor" aria-label="anchor" href="#origindestination-matrix"></a>
</h2>
<p>The description of movements in a certain area is represented by an
Origin-Destination matrix (OD matrix). The area of interest is divided
into <span class="math inline">\(n\)</span> locations and <span class="math inline">\(T_{ij}\)</span> represents the volume of flows
between location <span class="math inline">\(i\)</span> and location
<span class="math inline">\(j\)</span>. This volume usually represents a
number of trips or a commuting flow (i.e. number of individuals living
in <span class="math inline">\(i\)</span> and working in <span class="math inline">\(j\)</span>). The OD matrix is squared, contains
only positive values and can be a zero-diagonal matrix (Figure 1).</p>
<br><center>
<img align="bottom" width="60%" height="60%" src="../reference/figures/OD.png">
</center>
<br><center>
<b>Figure 1: Schematic representation of an Origin-Destination
matrix.</b>
</center>
<p><br></p>
</div>
<div class="section level2">
<h2 id="aggregated-inputs-information">Aggregated inputs information<a class="anchor" aria-label="anchor" href="#aggregated-inputs-information"></a>
</h2>
<p>Three categories of inputs are usually considered to simulate an OD
matrix (Figure 2). The masses and distances are the main ingredients
used to generate a matrix of probabilities based on a given distribution
law. Hence, the probability <span class="math inline">\(p_{ij}\)</span>
to observe a trip from location <span class="math inline">\(i\)</span>
to another location <span class="math inline">\(j\)</span> is based on
the masses, the demand at origin (<span class="math inline">\(m_i\)</span>) and the offer at destination (<span class="math inline">\(m_j\)</span>). Typically, the population is used
as surrogate for the demand and offer. The probability of movements also
depends on the costs based on the distance <span class="math inline">\(d_{ij}\)</span> between locations or the number of
opportunities <span class="math inline">\(s_{ij}\)</span> between
locations depending on the chosen law (more details in the next “Trip
distribution laws” section). In general both the effect of the cost can
be adjusted with a parameter.</p>
<p>The margins are used to generate an OD matrix based on the matrix of
probabilities by preserving the total number of trips (<span class="math inline">\(N\)</span>), the number of out-going trips (<span class="math inline">\(O_i\)</span>) and/or the number of in-coming trips
(<span class="math inline">\(D_j\)</span>) (more details in the
“Contrained distribution models” section).</p>
<br><center>
<img align="bottom" width="75%" height="75%" src="../reference/figures/Inputs.png">
</center>
<br><center>
<b>Figure 2: Schematic representation of the aggregated inputs
information. </b>
</center>
<p><br></p>
</div>
<div class="section level2">
<h2 id="trip-distribution-laws">Trip distribution laws<a class="anchor" aria-label="anchor" href="#trip-distribution-laws"></a>
</h2>
<p>The purpose of a trip distribution law is to estimate the probability
<span class="math inline">\(p_{ij}\)</span> that out of all the possible
travels in the system we have one between the location <span class="math inline">\(i\)</span> and the location <span class="math inline">\(j\)</span>. This probability is asymmetric in
<span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> as the flows themselves. It takes the
form of squared matrix of probabilities. This probability is normalized
to all possible couples of origins and destinations, <span class="math inline">\(\sum_{i,j=1}^n p_{ij} =1\)</span>. Hence, a matrix
of probabilities can be obtained by normalizing any OD matrix (Figure
3).</p>
<br><center>
<img align="bottom" width="60%" height="60%" src="../reference/figures/Proba.png">
</center>
<br><center>
<b>Figure 3: Schematic representation of the matrix of probabilities.
</b>
</center>
<p><br></p>
<p>As mentioned in the previous section, most of the trip distribution
law depends on the demand at origin (<span class="math inline">\(m_i\)</span>), the offer at destination (<span class="math inline">\(m_j\)</span>) and a cost to move from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span>. There are two major approaches for the
estimation of the matrix of probability. The traditional gravity
approach, in analogy with the Newton’s law of gravitation, is based on
the assumption that the amount of trips between two locations is related
to their populations and decays with a function of the distance <span class="math inline">\(d_{ij}\)</span> between locations. In contrast to
the gravity law, the laws of intervening opportunities hinges on the
assumption that the number of opportunities <span class="math inline">\(s_{ij}\)</span> between locations plays a more
important role than the distance <span class="citation">(Lenormand,
Bassolas, and Ramasco 2016)</span>. This fundamental difference between
the two schools of thought is illustrated in Figure 4.</p>
<br><center>
<img align="bottom" width="50%" height="50%" src="../reference/figures/GravVsOpp.png">
</center>
<br><center>
<b>Figure 4: Illustration of the fundamental difference between gravity
and intervening opportunity laws. </b>
</center>
<p><br></p>
<p>It is important to note that the effect of the cost between locations
(distance or number of opportunities) can usually be adjusted with a
parameter that can be calibrated automatically or by comparing the
simulated matrix with observed data (more details in the example based
on real commuting data in Kansas below).</p>
</div>
<div class="section level2">
<h2 id="constrained-distribution-models">Constrained distribution models<a class="anchor" aria-label="anchor" href="#constrained-distribution-models"></a>
</h2>
<p>The purpose of the trip distribution models is to generate an OD
matrix <span class="math inline">\(\tilde{T}=(\tilde{T}_{ij})\)</span>
by drawing at random <span class="math inline">\(N\)</span> trips from
the trip distribution law <span class="math inline">\((p_{ij})_{1 \leq
i,j \leq n}\)</span> respecting different level of constraints according
to the model. We considered four different types of models in this
package. As can be observed in Figure 5, the four models respect
different level of constraints from the total number of trips to the
total number of out-going and in-coming trips by locations (i.e. the
margins).</p>
<br><center>
<img align="bottom" width="80%" height="80%" src="../reference/figures/Models.png">
</center>
<br><center>
<b>Figure 5: Schematic representation of the constrained distribution
models. </b>
</center>
<p><br></p>
<p>More specifically, the volume of flows <span class="math inline">\(\tilde{T}_{ij}\)</span> is generated from the
matrix of probability with multinomial random draws that will take
different forms according to the model used <span class="citation">(Lenormand, Bassolas, and Ramasco 2016)</span>.
Therefore, since the process is stochastic, each simulated matrix is
unique and composed of integers. Note that it is also possible to
generate an average matrix from the multinomial trials.</p>
</div>
<div class="section level2">
<h2 id="goodness-of-fit-measures">Goodness-of-fit measures<a class="anchor" aria-label="anchor" href="#goodness-of-fit-measures"></a>
</h2>
<p>Finally, the trip distribution laws can be calibrated and both the
trip distribution laws and models can be evaluated by comparing a
simulated matrix <span class="math inline">\(\tilde{T}\)</span> with the
observed one <span class="math inline">\(T\)</span>. These comparison
are based on different goodness-of-fit measures that can take into
accounts the distance between location or not (more details in the
example based on real commuting data in Kansas below).</p>
</div>
<div class="section level2">
<h2 id="example-of-commuting-in-kansas">Example of commuting in Kansas<a class="anchor" aria-label="anchor" href="#example-of-commuting-in-kansas"></a>
</h2>
<div class="section level3">
<h3 id="origindestination-matrix-1">Origin–Destination matrix<a class="anchor" aria-label="anchor" href="#origindestination-matrix-1"></a>
</h3>
</div>
<div class="section level3">
<h3 id="aggregated-inputs-information-1">Aggregated inputs information<a class="anchor" aria-label="anchor" href="#aggregated-inputs-information-1"></a>
</h3>
</div>
<div class="section level3">
<h3 id="run-functions">Run functions<a class="anchor" aria-label="anchor" href="#run-functions"></a>
</h3>
<p>In this package, only inter-location flows are considered for the
distribution laws, meaning that the matrix of probabilities (and
associated simulated OD matrices) generated by a given distribution law
with <a href="https://epivec.github.io/TDLM/reference/run_law_model.html">run_law_model</a>
or <a href="https://epivec.github.io/TDLM/reference/run_law.html">run_law</a>
is a zero-diagonal matrix. Nevertheless, it is possible to generate
intra-location flows with <a href="https://epivec.github.io/TDLM/reference/run_law.html">run_model</a>
taking any kind of matrix of probabilities as input (see the example of
Kansas below).</p>
</div>
<div class="section level3">
<h3 id="parameter-calibration-and-model-evalution">Parameter calibration and model evalution<a class="anchor" aria-label="anchor" href="#parameter-calibration-and-model-evalution"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Lenormand2016" class="csl-entry">
Lenormand, M., A. Bassolas, and J. J. Ramasco. 2016. <span>“Systematic
Comparison of Trip Distribution Laws and Models.”</span> <em>Journal of
Transport Geography</em> 51: 158–69.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Maxime Lenormand.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
