---
title: "Tutorial for TDLM"
author: "Maxime Lenormand"
date: "`r Sys.Date()`"
output: 
  html_vignette:
    number_sections: false
  html_document:
    toc: true
    toc_float:
    collapsed: false
    smooth_scroll: false
    toc_depth: 2
vignette: >
  %\VignetteIndexEntry{Tutorial for TDLM}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
bibliography: '`r system.file("REFERENCES.bib", package="TDLM")`'
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      fig.width = 8, fig.height = 8)
# Packages --------------------------------------------------------------------
suppressPackageStartupMessages({
  suppressWarnings({
    library(TDLM)
  })
})

options(tinytex.verbose = TRUE)

```

# Introduction

This tutorial aims at describing the different features of the R package `TDLM`. 
The main purpose of the `TDLM`'s package is to propose a rigorous framework to 
fairly compare trip distribution laws and models [@Lenormand2016]. This general
framework is based on a two-step approach to generate mobility flows by 
separating the trip distribution law, gravity or intervening opportunities, from 
the modeling approach used to generate the flows from this law.

# A short note on terminology

This framework is part of the four-step travel model. It corresponds to the 
second step, called trip distribution, the aim of which is to match the trip 
origins with the trip destinations. The model used to generate the trips or 
flows, and more generally the degree of interaction between different locations,
are often called spatial interaction models. According to the research area, a 
matrix or a network formalism can be used to describe these spatial 
interactions. Origin-Destination matrix (or trip table) are often used in 
geography or transportation while in statistical physics or in the study of 
complex systems the term mobility networks is usually preferred. 

# Origin–Destination matrix

The description of movements in a certain area is represented by an
Origin-Destination matrix (OD matrix). The area of interest is divided into $n$ locations 
and $T_{ij}$ represents the volume of flows between location $i$ and 
location $j$. This volume usually represents a number of trips 
or a commuting flow (i.e. number of individuals living in $i$ and working in 
$j$). The OD matrix is squared, contains only positive values and can be a
zero-diagonal matrix (Figure 1). 

<br>
<center>
  <img align="bottom" width="60%" height="60%" src="../man/figures/OD.png">
</center> 
<br>
<center>
  <b>Figure 1: Schematic representation of an Origin-Destination matrix.</b>
</center> 
<br>

# Aggregated inputs information

Three categories of inputs are considered 

<br>
<center>
  <img align="bottom" width="75%" height="75%" src="../man/figures/Inputs.png">
</center> 
<br>
<center>
  <b>Figure 2: Schematic representation of the aggregated inputs information.
  </b>
</center> 
<br>

# Gravity and intervening opportunities laws

<br>
<center>
  <img align="bottom" width="60%" height="60%" src="../man/figures/Proba.png">
</center> 
<br>
<center>
  <b>Figure 3: Schematic representation of the matrix of probabilities.
  </b>
</center> 
<br>



<br>
<center>
  <img align="bottom" width="50%" height="50%" 
  src="../man/figures/GravVsOpp.png">
</center> 
<br>



# Constrained models

<br>
<center>
  <img align="bottom" width="80%" height="80%" src="../man/figures/Models.png">
</center> 
<br>
<center>
  <b>Figure 4: Schematic representation of the constrained models.
  </b>
</center> 
<br>

# Goodness-of-fit measures

# Parameter calibration

# Example of commuting in Kansas

## Origin–Destination matrix

## Aggregated inputs information


## Run functions

In this package, 
only inter-location flows are considered for the distribution laws, meaning that
the matrix of probabilities (and associated simulated OD matrices) generated by
a given distribution law with 
[run_law_model](https://epivec.github.io/TDLM/reference/run_law_model.html) or
[run_law](https://epivec.github.io/TDLM/reference/run_law.html) is a 
zero-diagonal matrix. Nevertheless, it is possible to generate intra-location 
flows with [run_model](https://epivec.github.io/TDLM/reference/run_law.html) 
taking any kind of matrix of probabilities as input (see the example of 
Kansas below).

## Parameter calibration and model evalution

# References
